var open = $("#<%= @element.js_id %>").data("toggle")
console.log(open)
if(open == 'open' ){
	close_node("#<%= @element.js_id %>")
	<% if @auto_open %>
		open_node("#<%= @element.js_id %>")
	<% end %>
} else {
	if(open == 'close'){
		open_node("#<%= @element.js_id %>")
	}
}

function close_node(id) {
	$(id).data('toggle','closing')
	$(id).children("div").addClass('animate-remove')
	$(id).children("div").slideUp(200, function(){
		$(id).children("div.animate-remove").remove()
    });
	$(id).children("span.nested-caret").children("a").html("&#8711;")
	$(id).children("span.nested-caret").children("a").attr("href","<%= @element.node_path(status: :open) %>")
	$(id).data('toggle','close')
}

function open_node(id) {
	<% if @children and @children.any? %>	
		$(id).data('toggle','opening')
		<% @children.each do |child| %>
			$("#<%= child.js_id %>").remove()
			$(id).append("<%= j (render @node_template, element: child, scope: @search_params) %>")
			$("#<%= child.js_id %>").slideDown(250)
		<% end %>
		$(id).children("span.nested-caret").children("a").html("&#8710;")
		$(id).data('toggle','open')
		$(id).children("span.nested-caret").children("a").attr("href","<%= @element.node_path(status: :close) %>")
	<% end %>
}




